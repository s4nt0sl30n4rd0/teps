#!/bin/bash
#
# teps - Replaces spaces in file and directory names.
#
# Author:
#  Leonardo Santos
#  <27875029+s4nt0sl30n4rd0@users.noreply.github.com>
#
# Maintenance:
#  Leonardo Santos
#  <27875029+s4nt0sl30n4rd0@users.noreply.github.com>
#
# -------------------------------------------------------------------------
#
# This program exchanges spaces for underscores in file and directory names
# recursively within the given directory, including itself. If a name or
# path to a directory is not entered as a parameter, it will act within
# the current directory, without including it.
#
# -------------------------------------------------------------------------
#
# License:
#
#  General Public License 3.0
#
# -------------------------------------------------------------------------
usage(){
cat << EOF
Usage:
     $(basename $0) [DIR]
     $(basename $0) [-h]

     Replaces spaces in file and directory names.

     Exchanges spaces for underscores in file and directory names
     recursively within the given directory, including itself.

Options:
     DIR Name, relative or absolute path of a directory.
     -h  Display this help and exit.

     If a name or path to a directory is not entered as a parameter, it
     will act within the current directory, without including it.

Exit Status:
     Returns 0 for success and 1 for failure.
EOF
}

[ "$1" = '-h' ] \
&& {
  usage
  exit 0
}

[ ! -d "$1"  ] \
&& {
  usage
  exit 1
}

rename(){
  space=1

  while [ $space -ne 0 ]
  do
    find -print0 | xargs -0 rename.ul ' ' '_' * 2> /dev/null
    space=$(find -print0 | grep -c ' ')
  done
}

if [ -n "$1" ]
then
  target=$1

  cd "$target" \
  || {
    echo 'Error: file or directory not found.'
    exit 1
  }

  rename
  cd ..

  target=$(basename "$target")

  mv "$target" "${target// /_}"
else
  target=$PWD

  rename
fi
